### PWM (펄스 폭 변조, Pulse Width Modulation) 신호

PWM은 **주기적으로 신호를 켜고 끄는 방식**으로 평균 전압을 제어하는 기술입니다. 이 방식을 통해 전압을 **정확하게 조절**할 수 있으며, 다양한 전자 기기에서 활용됩니다. PWM 신호의 두 가지 주요 특징은 **주기 (Period)** 와 **듀티 사이클 (Duty Cycle)** 입니다.

1. **주기 (Period)**: 신호가 한 번 반복되는 시간입니다. 예를 들어, 주기가 1초라면, 신호는 1초마다 반복됩니다. 
2. **듀티 사이클 (Duty Cycle)**: 신호가 켜져 있는 시간과 꺼져 있는 시간의 비율입니다. 예를 들어, 50% 듀티 사이클은 주기 동안 신호가 절반 시간 동안 켜지고, 나머지 절반 시간 동안 꺼짐을 의미합니다.

### PWM의 사용 이유

PWM은 **전력 제어**, **소리 생성**, **모터 속도 제어**, **디밍 조명** 등 다양한 분야에서 활용됩니다. 중요한 이유는:
- **전압 제어**가 어려운 시스템에서 전력 또는 신호의 강도를 **효율적으로 조절**할 수 있기 때문입니다.
- **평균 전압을 제어**하여 디지털 신호만을 사용해 아날로그적인 효과를 낼 수 있습니다.

### PWM을 사용하는 예시들
- **버저에서 소리 내기**: 버저의 주파수와 강도를 제어하는 데 PWM을 사용하여 소리의 **높낮이**와 **강도**를 조정합니다.
- **LED 밝기 조정**: PWM을 사용하여 LED의 밝기를 조절할 수 있습니다. 듀티 사이클이 높을수록 LED가 더 밝게 빛납니다.
- **모터 속도 제어**: PWM 신호를 사용하여 모터에 공급되는 전압을 조절함으로써 **모터의 회전 속도**를 제어합니다.

### 코드 분석: 버저 제어를 위한 PWM 설정

이 코드는 **ATmega 계열 마이크로컨트롤러**에서 **버저**를 제어하기 위한 코드입니다. 이 코드에서 **PWM 신호를 설정하고, 주파수 및 듀티 사이클을 조정**하여 버저의 소리를 제어합니다.

#### 1. `Buzzer_soundOn()` - 버저를 켜는 함수
```c
void Buzzer_soundOn()
{
    TCCR3A |= ((1<<COM3A1) | (0<<COM3A0));
}
```
- 이 함수는 **PWM 신호를 출력**하여 버저를 켭니다. `TCCR3A` 레지스터의 `COM3A1` 비트를 설정하여 타이머 3의 출력 핀에 PWM 신호를 전송합니다.

#### 2. `Buzzer_soundOff()` - 버저를 끄는 함수
```c
void Buzzer_soundOff()
{
    TCCR3A &= ~((1<<COM3A1) | (1<<COM3A0));
}
```
- 이 함수는 **PWM 신호를 멈추게** 하여 버저를 끕니다. `COM3A1`과 `COM3A0` 비트를 초기화하여 PWM 신호를 멈춥니다.

#### 3. `Buzzer_makehz(uint8_t strength, uint16_t hertz)` - 주파수 설정 함수
```c
void Buzzer_makehz(uint8_t strength, uint16_t hertz)
{
    if (hertz < 100) hertz = 100;       // 100Hz 미만은 100Hz로 설정
    else if (hertz > 5000) hertz = 5000; // 5000Hz 초과는 5000Hz로 설정
    BUZZER_ICR = (250000 / hertz) - 1;   // 주파수 설정
    OCR3A = BUZZER_ICR / 4;              // 25% 듀티 사이클로 설정
}
```
- 이 함수는 **버저의 주파수**를 설정합니다. 주파수가 100Hz 미만이거나 5000Hz 이상일 경우 범위를 제한하고, 주파수에 맞게 **타이머**의 **ICR** 값을 계산하여 설정합니다.
- `OCR3A`는 PWM의 **듀티 사이클**을 설정하는 레지스터입니다. 25% 듀티 사이클로 설정하여 소리가 일정하게 울리도록 합니다.

#### 4. `Buzzer_init()` - 초기화 함수
```c
void Buzzer_init()
{
    TCCR3B |= (0<<CS32) | (1<<CS31) | (1<<CS30); // 타이머 클럭 설정
    TCCR3B |= ((1<<WGM33) | (1<<WGM32));         // Fast PWM 모드 설정
    TCCR3A |= ((1<<WGM31) | (0<<WGM30));         // Fast PWM 모드 설정
    DDRE |= (1<<3);                             // 핀 3을 출력으로 설정
}
```
- 이 함수는 **PWM 모드**를 설정하고, **타이머**를 초기화하여 **버저**가 작동할 준비를 합니다.
- `WGM33`, `WGM32`, `WGM31`, `WGM30` 비트를 설정하여 **Fast PWM 모드**를 활성화하고, 타이머의 클럭을 설정하여 주기를 맞춥니다.

#### 5. `Buzzer_buttonOn(uint8_t strength, uint16_t hertz)` - 버튼을 눌렀을 때 버저 제어
```c
void Buzzer_buttonOn(uint8_t strength, uint16_t hertz)
{
    Buzzer_makehz(strength, hertz);  // 주파수 설정
    _delay_ms(10);                   // 10ms 대기
    TCNT3 = 0;                        // 타이머 초기화
}
```
- 이 함수는 **버저의 주파수**를 설정한 뒤, 잠시 **버저가 울리도록** 합니다. `TCNT3 = 0;`으로 타이머를 초기화하여 **정확한 주기**를 유지하도록 합니다.

### PWM을 사용하여 버저 제어

이 코드에서 **PWM을 사용하여 버저를 제어**하는 이유는:
- **주파수 조정**: 주파수를 설정하여 버저의 **소리 높낮이**를 조정합니다.
- **듀티 사이클 조정**: 듀티 사이클을 조정하여 버저의 **소리 강도**를 설정합니다.
  - 예를 들어, 듀티 사이클이 50%이면 소리가 일정한 강도로 계속 울리고, 100% 듀티 사이클이면 더 강한 소리가 나게 됩니다.

### 요약

PWM 신호는 **주파수**와 **듀티 사이클**을 조절하여 **소리의 높낮이**와 **강도**를 세밀하게 제어할 수 있는 방식입니다. 코드에서는 **Fast PWM 모드**를 사용하여 **버저의 주파수**와 **소리 강도**를 설정하며, 이를 통해 원하는 소리를 낼 수 있게 됩니다.