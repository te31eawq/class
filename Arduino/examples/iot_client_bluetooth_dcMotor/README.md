이 코드는 **Arduino**와 **Bluetooth 모듈(HC-06 또는 HC-05)**을 사용하여, 버튼 클릭, 온도/습도 측정, 조도 센서 값, 모터 속도 제어 등을 처리하는 **스마트 IoT 장치**의 동작을 구현한 예제입니다. 주요 기능은 LCD 화면에 센서 데이터를 표시하고, Bluetooth로 명령을 수신하여 LED와 모터를 제어하며, 센서 데이터를 주기적으로 전송하는 것입니다.

### 1. **사용된 라이브러리**
- `SoftwareSerial`: Bluetooth 모듈과의 통신을 위해 사용하는 소프트웨어 시리얼 포트 라이브러리.
- `Wire`: I2C 통신을 위한 라이브러리. LCD 화면과 통신을 위해 사용됩니다.
- `DHT`: DHT 온도/습도 센서를 읽기 위한 라이브러리.
- `MsTimer2`: 타이머 인터럽트를 사용하여 주기적인 작업을 수행하는 라이브러리.
- `LiquidCrystal_I2C`: I2C LCD 화면을 제어하는 라이브러리.

### 2. **핵심 변수 및 설정**
```cpp
#define CDS_PIN A0        // 조도 센서 핀
#define BUTTON_PIN 2      // 버튼 핀
#define DHTPIN 4          // DHT 센서 핀
#define MOTOR_PIN 6       // 모터 제어 핀
#define LED_BUILTIN_PIN 13 // 내장 LED 핀

#define DHTTYPE DHT11     // DHT 센서 타입 (DHT11 사용)
#define ARR_CNT 5         // 명령어 배열 크기
#define CMD_SIZE 60       // 명령어 크기

char lcdLine1[17] = "Smart IoT By KSH";  // LCD 첫 번째 줄
char lcdLine2[17] = "";                  // LCD 두 번째 줄
char sendBuf[CMD_SIZE];                  // Bluetooth 전송 버퍼
char recvId[10] = "CJW_LIN";             // 클라이언트 ID (SQL 저장용)
```

- **센서 및 핀 설정**: CDS 센서(조도 센서), DHT 센서(온도 및 습도 센서), 버튼, LED, 모터 등 다양한 핀과 장치들을 설정합니다.
- **`MsTimer2`**: 1초마다 `timerIsr` 함수를 호출하여 주기적으로 센서 값을 읽고 LCD에 업데이트하는 기능을 담당합니다.

### 3. **핵심 기능**
#### 3.1 **Bluetooth 통신 처리 (bluetoothEvent 함수)**
- Bluetooth 모듈로부터 수신한 명령을 처리합니다. 명령은 `@` 기호로 구분되어 있으며, 예를 들어 `"LED@ON"`, `"MOTOR@50"`, `"GETSENSOR@10"` 등의 명령을 수신하여 처리합니다.
  
#### 3.2 **센서 데이터 읽기 및 LCD 표시**
- **DHT 센서**에서 온도와 습도를 읽어 LCD 화면에 표시합니다.
- **CDS 센서**에서 조도 값을 읽어 LCD에 표시하고, 그 값을 Bluetooth로 전송합니다.
- `MsTimer2` 타이머를 사용하여 1초마다 센서 값을 갱신하고, LCD에 표시합니다.

#### 3.3 **버튼 처리 및 LED 제어**
- 버튼을 누르면 내장 LED의 상태가 반전되며, Bluetooth로 해당 상태를 전송합니다.
- **디바운싱**을 통해 버튼 상태가 안정될 때까지 기다립니다.

#### 3.4 **모터 속도 제어**
- Bluetooth로 수신한 명령을 통해 모터의 속도를 조정할 수 있습니다. `MOTOR@50`과 같은 명령을 수신하면, 모터의 속도가 조정됩니다.

#### 3.5 **타이머 인터럽트**
- `MsTimer2`를 사용하여 1초마다 타이머 인터럽트를 발생시키고, 이를 통해 센서 값을 주기적으로 갱신합니다. `secCount`가 증가하고, 이 값을 바탕으로 센서 값을 읽고 전송할 시점을 결정합니다.

### 4. **주요 함수 설명**

#### `bluetoothEvent()`
- Bluetooth 모듈에서 명령을 수신하여 해당 명령에 맞는 동작을 수행합니다.
- 명령은 **LED**, **MOTOR**, **GETSENSOR**와 같은 키워드로 시작하고, 각각 LED를 켜거나 끄거나, 모터 속도를 조절하거나, 센서 값을 요청하는 동작을 수행합니다.

#### `timerIsr()`
- 1초마다 호출되어 `secCount`를 증가시키고, 센서 값을 갱신할지 여부를 결정합니다.

#### `lcdDisplay()`
- LCD 화면에 문자열을 표시하는 함수입니다. 주어진 좌표에서 화면을 갱신합니다.

#### `debounce()`
- 버튼의 디바운싱을 처리하여 버튼 상태가 안정될 때까지 기다린 후, 안정된 상태를 반환합니다.

### 5. **Bluetooth 명령 처리 예시**
1. **LED 제어**:
   - `LED@ON` 또는 `LED@OFF` 명령을 수신하면, LED를 켜거나 끕니다.
2. **모터 속도 제어**:
   - `MOTOR@50`과 같은 명령을 수신하면 모터의 속도를 0에서 255 사이의 값으로 설정합니다.
3. **센서 값 요청**:
   - `GETSENSOR@10`과 같은 명령을 수신하면, 10초마다 센서 값을 전송하도록 설정합니다.
4. **CDS 값에 따른 알림**:
   - CDS 센서 값이 50 이상이면 해당 값을 Bluetooth로 전송하며, 값이 50 미만이면 다시 알림을 전송합니다.

### 6. **전체 동작 흐름**
1. **Bluetooth**를 통해 외부에서 명령을 수신하여, 명령에 따라 **LED**, **모터**, **센서** 값을 제어합니다.
2. 주기적으로 **온도**, **습도**, **조도** 값을 읽어 LCD에 표시하고, Bluetooth로 전송합니다.
3. **버튼**을 눌러 LED의 상태를 변경하고, Bluetooth로 상태를 전송합니다.
4. **타이머 인터럽트**를 사용하여 1초마다 센서 값을 갱신하고, LCD와 Bluetooth로 전송합니다.

### 7. **디버그 및 LCD 출력**
- 디버그 모드에서 시리얼 모니터에 메시지를 출력하여 각 동작을 확인할 수 있습니다.
- LCD 화면에 **온도**, **습도**, **조도** 값을 실시간으로 표시합니다.

### 8. **전체적인 사용 예**
- 이 코드는 Bluetooth 모듈을 통해 원격에서 IoT 장치를 제어하고 센서 값을 모니터링할 수 있는 스마트 IoT 장치의 기본적인 예제입니다.